#!/usr/bin/make -f

export QT_SELECT=qt5

override_dh_auto_configure:
	dh_auto_configure -- -DCMAKE_BUILD_TYPE=Release
	mkdir -p gmic-qt/build
	cd gmic-qt/build && cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_SYSCONFDIR=/etc -DCMAKE_INSTALL_LOCALSTATEDIR=/var -DCMAKE_EXPORT_NO_PACKAGE_REGISTRY=ON -DCMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY=ON "-GUnix Makefiles" -DCMAKE_VERBOSE_MAKEFILE=ON -DCMAKE_INSTALL_LIBDIR=lib/x86_64-linux-gnu -DGMIC_PATH=../src ..
	cd zart && qmake

override_dh_auto_build:
	dh_auto_build
	cd zart && make
	cd gmic-qt/build && make

override_dh_auto_install:
	dh_auto_install
	mkdir -p $(CURDIR)/debian/tmp/usr/bin
	cp zart/zart $(CURDIR)/debian/tmp/usr/bin/zart
	mkdir -p $(CURDIR)/debian/tmp/etc/bash_completion.d/
	cp resources/gmic_bashcompletion.sh $(CURDIR)/debian/tmp/etc/bash_completion.d/gmic
	mkdir -p $(CURDIR)/debian/tmp/usr/lib/gimp/2.0/plug-ins
	cp resources/gmic_film_cluts.gmz $(CURDIR)/debian/tmp/usr/lib/gimp/2.0/plug-ins
	cp gmic-qt/build/gmic_gimp_qt $(CURDIR)/debian/tmp/usr/lib/gimp/2.0/plug-ins/gmic_gimp

clean:
	dh $@
	if [ -f zart/Makefile ]; then cd zart && make distclean; fi
	rm -rf gmic-qt/build

%:
	dh $@

# vim:ts=4 sw=2 noet
